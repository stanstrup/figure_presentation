# Which image format for which purpose? {background-color="#3498db"}

```{r}
#| label: setup-formats
#| echo: false
#| eval: true
#| message: false
#| warning: false

library(ggplot2)
library(magick)
library(glue)
```

## What is a Raster Image?

:::: {.columns}
::: {.column width="50%"}
**Raster graphics are grids of colored pixels**

- Stores individual pixel colors: RGB(255, 128, 64)
- Fixed resolution measured in DPI (Dots Per Inch)
- More pixels = higher resolution = larger file size
- Cannot be scaled up without quality loss
:::

::: {.column width="50%"}
![](sources/Rgb-raster-image.svg){width=100%}
:::
::::

## What is a Vector Image?

```{r}
#| label: vector-curve-demo
#| echo: false
#| eval: true

# Create a smooth curved line
x <- seq(0, 4*pi, length.out = 200)
curve_data <- data.frame(
  x = x,
  y = sin(x) * exp(-x/10)
)

# Create the plot
p <- ggplot(curve_data, aes(x, y)) +
  geom_line(color = "steelblue", linewidth = 3) +
  geom_point(data = curve_data[seq(1, 200, 25), ],
             color = "darkred", size = 4) +
  theme_classic(base_size = 16) +
  theme(
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  ) +
  labs(x = "", y = "")

# Save as SVG (vector format)
ggsave("plots/03_formats/vector-curve.svg", p, width = 6, height = 4, device = "svg")
```

::::: {.columns}
:::: {.column width="50%"}
**Vector graphics use mathematical descriptions**

- Mathematical formulas define shapes and lines
- "Draw a line from point (0,0) to (10,10)"
- "Create a circle with center (5,5) and radius 3"
- Infinitely scalable without quality loss

::: {.callout-note}
## Infinite Resolution
Because vectors are mathematical formulas, they can be scaled to **any size** without losing quality. The curve is defined by equations, not pixels!
:::
::::

:::: {.column width="50%"}
![](plots/03_formats/vector-curve.svg){width=100%}
::::
:::::



## Vector vs. Raster Comparison


```{r}
#| label: vector-raster-comparison
#| echo: false
#| eval: true
#| fig-width: 12
#| fig-height: 6

# Create a smooth curve with text
x <- seq(0, 4*pi, length.out = 200)
curve_data <- data.frame(x = x, y = sin(x) * exp(-x/10))

p <- ggplot(curve_data, aes(x, y)) +
  geom_line(color = "steelblue", linewidth = 3) +
  geom_point(data = curve_data[seq(1, 200, 20), ],
             color = "darkred", size = 4) +
  annotate("text", x = 6, y = 0.6,
           label = "Smooth Curve",
           size = 10, fontface = "bold", color = "navy") +
  theme_classic(base_size = 18) +
  theme(plot.title = element_text(face = "bold", size = 20)) +
  labs(title = "Mathematical Curve", x = "", y = "")

# Save as SVG (vector - web compatible)
ggsave("plots/03_formats/vector_demo.svg", p, width = 8, height = 4)

# Save as low-res PNG (raster)
ggsave("plots/03_formats/raster_demo.png", p, width = 8, height = 4, dpi = 72)

# Read the saved images and zoom in to show difference
oversize_scale <- 10
vector <- image_read_svg("plots/03_formats/vector_demo.svg", width = 576*oversize_scale)

vector_crop <- vector %>% 
  image_crop(glue("{100*oversize_scale}x{50*oversize_scale}+{300*oversize_scale}+{75*oversize_scale}")) %>% 
  image_scale("900x600")


oversize_scale <- 1
raster_crop <- image_read("plots/03_formats/raster_demo.png",   density = 72*oversize_scale) %>% 
  image_crop(glue("{100*oversize_scale}x{50*oversize_scale}+{300*oversize_scale}+{75*oversize_scale}")) %>% 
  image_scale("900x600")


# Add labels
vector_labeled <- image_annotate(vector_crop, "VECTOR (SVG)\nStays Crisp",
                                  size = 40, color = "green",
                                  location = "+10+10", font = "sans", weight = 700)
raster_labeled <- image_annotate(raster_crop, "RASTER (PNG 72 DPI)\nPixelated",
                                  size = 40, color = "red",
                                  location = "+10+10", font = "sans", weight = 700)

vector
```

## Vector vs. Raster Comparison (2)

```{r}
#| label: vector-raster-comparison-2
#| echo: false
#| eval: true
#| fig-width: 12
#| fig-height: 6

# Combine side by side
combined <- image_append(c(vector_labeled, raster_labeled))
combined
```

| Aspect | Vector (PDF, SVG, EPS) | Raster (PNG, TIFF, JPG) |
|--------|------------------------|-------------------------|
| **Definition** | Mathematical formulas | Grid of pixels |
| **Scalability** | Infinite resolution | Fixed resolution (DPI) |
| **File Size** | Small (formulas compact) | Large (all pixels stored) |
| **Best For** | Plots, diagrams, text, screenshots of websites | Photos, screenshots |
| **Editability** | Easy to edit paths | Pixel-level editing only |
| **Text Quality** | Always crisp | Can become blurry |



## Container Formats: PDF and TIFF

::: {.callout-important}
## PDF and TIFF are Containers!

Both **PDF** and **TIFF** can contain EITHER vector OR raster data:

- **PDF**: Can contain vector graphics, raster images, or both
- **TIFF**: Usually raster, but can embed vector data
:::

**TIFF Compression Options:**

| Type | Description | Use Case |
|------|-------------|----------|
| **Uncompressed** | No compression (huge files) | Archival |
| **LZW** | Lossless compression | Publications |
| **ZIP** | Lossless compression | Publications |
| **JPEG** | Lossy compression | Web (avoid for science) |



## JPEG Compression Artifacts

```{r}
#| label: jpeg-artifacts
#| echo: false
#| eval: true
#| fig-width: 12
#| fig-height: 6

# Create a plot with sharp edges and text
create_test_plot <- function() {
  ggplot(data.frame(x = c(0, 1, 1, 0, 0),
                    y = c(0, 0, 1, 1, 0)),
         aes(x, y)) +
    geom_polygon(fill = "white", color = "black", linewidth = 2) +
    annotate("text", x = 0.5, y = 0.5,
             label = "SHARP TEXT",
             size = 12, fontface = "bold") +
    theme_void() +
    theme(plot.background = element_rect(fill = "gray90", color = NA)) +
    coord_fixed()
}

p <- create_test_plot()

# Save as PNG (lossless) and JPEG (lossy with low quality)
ggsave("plots/03_formats/artifacts_original.png", p, width = 4, height = 4, dpi = 150)
ggsave("plots/03_formats/artifacts_jpeg.jpg", p, width = 4, height = 4, dpi = 150, quality = 60)

# Read and zoom in on the edge to show artifacts
png_img <- image_read("plots/03_formats/artifacts_original.png")
jpeg_img <- image_read("plots/03_formats/artifacts_jpeg.jpg")

# Crop and zoom 4x on the edge where artifacts are visible
crop_geom <- "100x100+450+250"
png_crop <- image_crop(png_img, crop_geom) %>% image_scale("600x600")
jpeg_crop <- image_crop(jpeg_img, crop_geom) %>% image_scale("600x600")

# Add labels
png_labeled <- image_annotate(png_crop, "PNG (Lossless)\nSharp Edges",
                               size = 30, color = "green",
                               location = "+10+10", font = "sans", weight = 700)
jpeg_labeled <- image_annotate(jpeg_crop, "JPEG (Quality 60)\nCompression Artifacts",
                                size = 30, color = "red",
                                location = "+10+10", font = "sans", weight = 700)

# Combine side by side
combined <- image_append(c(png_labeled, jpeg_labeled))
combined
```



## Format Properties Comparison

| Format | Type | Compression | Container? | Notes |
|--------|------|-------------|------------|-------|
| **PDF** | Vector + Raster | Lossless | Yes | Can embed both vector and raster data |
| **EPS** | Vector | Lossless | Yes | Can embed fonts and images |
| **SVG** | Vector | Lossless | No | XML-based, web-native |
| **PNG** | Raster | Lossless | No | Supports transparency |
| **TIFF** | Raster | Lossless or Lossy | Yes | Multiple pages, various compression options |
| **JPEG** | Raster | Lossy | No | Best for photos only |
| **WebP** | Raster | Lossless or Lossy | No | Modern web format, smaller than PNG/JPEG |

: {tbl-colwidths="[10,18,15,10,47]"}

::: {.callout-note}

## Container Formats

**Container formats** can hold multiple types of data or multiple images:

- **PDF**: Can mix vector graphics, raster images, fonts, and text
- **EPS**: Can embed fonts, preview images, and vector data
- **TIFF**: Can contain multiple pages/images with different compression

**Non-container formats** store a single image with one encoding type.

:::


## File Format Comparison

```{r}
#| label: file-format-comparison
#| echo: false
#| eval: true
#| fig-width: 12
#| fig-height: 12

# Generate comparison files
comparison_plot <- ggplot(mtcars, aes(wt, mpg)) +
  geom_point(size = 3, color = "steelblue") +
  geom_smooth(method = "lm", color = "darkred", linewidth = 1.5) +
  annotate("text", x = 4, y = 30,
           label = "Zoom to see quality!",
           size = 6, fontface = "bold") +
  theme_classic(base_size = 14) +
  labs(title = "Vector vs Raster Comparison",
       x = "Weight (1000 lbs)",
       y = "Miles Per Gallon")

# Vector format - always crisp (SVG for web)
ggsave("plots/03_formats/compare_vector.svg", comparison_plot,
       width = 6, height = 4, device = "svg")

# High-res PNG - good quality
ggsave("plots/03_formats/compare_highres.png", comparison_plot,
       width = 6, height = 4, dpi = 300)

# Low-res PNG - pixelated when zoomed
ggsave("plots/03_formats/compare_lowres.png", comparison_plot,
       width = 6, height = 4, dpi = 72)

# JPEG - compression artifacts
ggsave("plots/03_formats/compare_jpeg.jpg", comparison_plot,
       width = 6, height = 4, dpi = 150, quality = 60)

# Read and zoom in on text area to show differences
# Base dimensions: 6 inches wide * 72 DPI = 432 pixels (low-res baseline)

# Vector: Read at very high resolution (10x the base size)
oversize_scale <- 10
vector_img <- image_read_svg("plots/03_formats/compare_vector.svg", width = 432*oversize_scale)

# Crop a region from the vector (scaled by oversize_scale) and zoom to display size
# Crop coordinates: x=250, y=20, width=150, height=75 (at base scale)
vector_crop <- vector_img %>%
  image_crop(glue("{150*oversize_scale}x{75*oversize_scale}+{250*oversize_scale}+{200*oversize_scale}")) %>%
  image_scale("600x300")

# PNG 300 DPI: Native size is 1800x1200 (6" * 300 DPI)
# Scale factor relative to 72 DPI base: 300/72 = 4.167
scale_300 <- 300/72
highres_crop <- image_read("plots/03_formats/compare_highres.png") %>%
  image_crop(glue("{150*scale_300}x{75*scale_300}+{250*scale_300}+{200*scale_300}")) %>%
  image_scale("600x300")

# PNG 72 DPI: Native size is 432x288 (6" * 72 DPI) - our baseline
scale_72 <- 1
lowres_crop <- image_read("plots/03_formats/compare_lowres.png") %>%
  image_crop(glue("{150*scale_72}x{75*scale_72}+{250*scale_72}+{200*scale_72}")) %>%
  image_scale("600x300")

# JPEG 150 DPI: Native size is 900x600 (6" * 150 DPI)
# Scale factor relative to 72 DPI base: 150/72 = 2.083
scale_150 <- 150/72
jpeg_crop <- image_read("plots/03_formats/compare_jpeg.jpg") %>%
  image_crop(glue("{150*scale_150}x{75*scale_150}+{250*scale_150}+{200*scale_150}")) %>%
  image_scale("600x300")

# Add labels
vector_labeled <- image_annotate(vector_crop, "SVG (Vector)",
                                  size = 25, color = "green",
                                  location = "+10+10", font = "sans", weight = 700)
highres_labeled <- image_annotate(highres_crop, "PNG 300 DPI",
                                   size = 25, color = "darkgreen",
                                   location = "+10+10", font = "sans", weight = 700)
lowres_labeled <- image_annotate(lowres_crop, "PNG 72 DPI",
                                  size = 25, color = "orange",
                                  location = "+10+10", font = "sans", weight = 700)
jpeg_labeled <- image_annotate(jpeg_crop, "JPEG Q60",
                                size = 25, color = "red",
                                location = "+10+10", font = "sans", weight = 700)

# Combine in 2x2 grid
top_row <- image_append(c(vector_labeled, highres_labeled))
bottom_row <- image_append(c(lowres_labeled, jpeg_labeled))
combined <- image_append(c(top_row, bottom_row), stack = TRUE)
combined
```

## Real world horror story



:::: {.columns}
::: {.column width="50%"}

This is the graphical abstract

![](sources/1-s2.0-S0003267012000062-fx1.jpg)

:::

::: {.column width="50%"}

This was one of the figures

![](sources/1-s2.0-S0003267012000062-gr4.jpg)

:::
::::









::: notes

Barri, T., Holmer-Jensen, J., Hermansen, K., & Dragsted, L. O. (2012). Metabolic fingerprinting of high-fat plasma samples processed by centrifugation- and filtration-based protein precipitation delineates significant differences in metabolite information coverage. Analytica Chimica Acta, 718, 47–57. https://doi.org/10.1016/j.aca.2011.12.065

:::


## Vector Screenshots from Websites

::: {.callout-tip}

## Capturing Website Content as Vector Graphics

### Print to PDF as you see the website

1. Open the webpage in Google Chrome
2. Open Chrome DevTools (`F12`)
3. Click "⋮"
4. Click "More Tools"
5. click "Rendering"
6. Set "Emulate CSS media type" to "screen"
7. "Print"to PDF


### Why This Matters

- **Text stays crisp** - Perfect for including web-based figures
- **Smaller file size** - Vector PDF is compact
- **Editable** - Can extract or edit elements in PDF editor
- **Publication quality** - No pixelation when zoomed

:::


**Examples:**

- Document online data visualization examples
- Include web-based tools in presentations and papers



## Format Selection: Decision Tree

```{mermaid}
%%{init: {'theme':'dark', 'themeVariables': {'edgeLabelBackground':'#1a1a1a', 'primaryTextColor':'#fff', 'secondaryTextColor':'#fff', 'tertiaryTextColor':'#fff'}}}%%

flowchart LR
    A[What type of image?] --> B{Photo}
    A --> C{Screenshot}
    A --> D{Generated figure/<br/>website snapshot}

    B --> B1{Where will it<br/>be used?}
    B1 -->|Publication| B2[TIFF LZW<br/>300+ DPI]
    B1 -->|Presentation/Web| B3[JPEG/WebP <br/> 150+ DPI]

    C --> C1{Where will it<br/>be used?}
    C1 -->|Publication| C2[TIFF LZW<br/>300+ DPI]
    C1 -->|Presentation/Web| C3[PNG<br/>150 DPI]

    D --> D1{Publication or<br/>presentation?}
    D1 -->|Publication| D2{Vector support?}
    D1 -->|Presentation/Web| D3[SVG or PNG]

    D2 -->|Yes| D4[PDF / SVG / EPS<br/>All equivalent vectors]
    D2 -->|No| D5[TIFF 600+ DPI LZW<br/>PNG not supported]

    style A fill:#5dade2,color:#fff
    style B fill:#5dade2,color:#fff
    style C fill:#5dade2,color:#fff
    style D fill:#5dade2,color:#fff
    style B1 fill:#5dade2,color:#fff
    style C1 fill:#5dade2,color:#fff
    style D1 fill:#5dade2,color:#fff
    style D2 fill:#5dade2,color:#fff
    style D4 fill:#2ecc71,color:#fff
    style D5 fill:#5dade2,color:#fff
    style D3 fill:#9b59b6,color:#fff
    style B2 fill:#3498db,color:#fff
    style B3 fill:#e74c3c,color:#fff
    style C2 fill:#3498db,color:#fff
    style C3 fill:#9b59b6,color:#fff

```

## Last notes

* Make sure that any art you include is vector based!
* Composing your figures in Powerpoint is OK - but use high quality source-material
* BioRender material is typically vector based


