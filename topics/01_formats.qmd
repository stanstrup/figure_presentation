# File Formats {background-color="#3498db"}

## The Format Question

**Which format should I use?**

::: {.incremental}

- **Type of image**

\

- Journal submission?
- Poster presentation?
- PowerPoint?
- Web/online?
:::

## What is a Vector Image?

**Vector graphics use mathematical descriptions**

- Mathematical formulas define shapes and lines
- "Draw a line from point (0,0) to (10,10)"
- "Create a circle with center (5,5) and radius 3"
- Infinitely scalable without quality loss

```{r}
#| echo: false
#| eval: true
#| fig-width: 12
#| fig-height: 6

library(ggplot2)
library(magick)

# Create a smooth curve with text
x <- seq(0, 4*pi, length.out = 200)
curve_data <- data.frame(x = x, y = sin(x) * exp(-x/10))

p <- ggplot(curve_data, aes(x, y)) +
  geom_line(color = "steelblue", linewidth = 3) +
  geom_point(data = curve_data[seq(1, 200, 20), ],
             color = "darkred", size = 4) +
  annotate("text", x = 6, y = 0.6,
           label = "Smooth Curve",
           size = 10, fontface = "bold", color = "navy") +
  theme_classic(base_size = 18) +
  theme(plot.title = element_text(face = "bold", size = 20)) +
  labs(title = "Mathematical Curve", x = "", y = "")

# Save as SVG (vector - web compatible)
ggsave("vector_demo.svg", p, width = 8, height = 4)

# Save as low-res PNG (raster)
ggsave("raster_demo.png", p, width = 8, height = 4, dpi = 72)

# Read the saved images and zoom in to show difference
vector_img <- image_read_svg("vector_demo.svg", width = 800)
raster_img <- image_read("raster_demo.png")

# Crop a section and zoom 3x to show the difference
crop_geom <- "300x200+250+100"
vector_crop <- image_crop(vector_img, crop_geom) %>% image_scale("900x600")
raster_crop <- image_crop(raster_img, crop_geom) %>% image_scale("900x600")

# Add labels
vector_labeled <- image_annotate(vector_crop, "VECTOR (SVG)\nStays Crisp",
                                  size = 40, color = "green",
                                  location = "+10+10", font = "sans", weight = 700)
raster_labeled <- image_annotate(raster_crop, "RASTER (PNG 72 DPI)\nPixelated",
                                  size = 40, color = "red",
                                  location = "+10+10", font = "sans", weight = 700)

# Combine side by side
combined <- image_append(c(vector_labeled, raster_labeled))
combined
```

**Zoomed 3× to show the difference - Vector stays smooth, Raster shows pixels**

::: {.callout-note}
## Infinite Resolution
Because vectors are mathematical formulas, they can be scaled to **any size** without losing quality. The curve is defined by equations, not pixels!
:::

## What is a Raster Image?

**Raster graphics are grids of colored pixels**

- Stores individual pixel colors: RGB(255, 128, 64)
- Fixed resolution measured in DPI (Dots Per Inch)
- More pixels = higher resolution = larger file size
- Cannot be scaled up without quality loss

```{r}
#| echo: false
#| eval: true
#| fig-width: 12
#| fig-height: 6

library(ggplot2)
library(magick)

# Same curve
x <- seq(0, 4*pi, length.out = 200)
raster_data <- data.frame(x = x, y = sin(x) * exp(-x/10))

p_base <- ggplot(raster_data, aes(x, y)) +
  geom_line(color = "steelblue", linewidth = 3) +
  geom_point(data = raster_data[seq(1, 200, 20), ],
             color = "darkred", size = 4) +
  annotate("text", x = 6, y = 0.6,
           label = "Same Curve",
           size = 10, fontface = "bold", color = "navy") +
  theme_classic(base_size = 18) +
  theme(plot.title = element_text(face = "bold", size = 20)) +
  labs(title = "Raster at Different DPI", x = "", y = "")

# Save as high-res PNG (300 DPI) - 2400 × 1200 pixels
ggsave("raster_300dpi.png", p_base, width = 8, height = 4, dpi = 300)

# Save as low-res PNG (72 DPI) - 576 × 288 pixels
ggsave("raster_72dpi.png", p_base, width = 8, height = 4, dpi = 72)

# Read the saved images
highres_img <- image_read("raster_300dpi.png")
lowres_img <- image_read("raster_72dpi.png")

# Crop same region and zoom 3x
crop_geom <- "300x200+250+100"
highres_crop <- image_crop(highres_img, crop_geom) %>% image_scale("900x600")
lowres_crop <- image_crop(lowres_img, crop_geom) %>% image_scale("900x600")

# Add labels
highres_labeled <- image_annotate(highres_crop, "300 DPI PNG\nSmooth",
                                   size = 40, color = "darkgreen",
                                   location = "+10+10", font = "sans", weight = 700)
lowres_labeled <- image_annotate(lowres_crop, "72 DPI PNG\nPixelated",
                                  size = 40, color = "darkred",
                                  location = "+10+10", font = "sans", weight = 700)

# Combine side by side
raster_combined <- image_append(c(highres_labeled, lowres_labeled))
raster_combined
```

**Zoomed 3× - High DPI has more pixels = smoother, Low DPI = visible pixelation**

::: {.callout-warning}
## Resolution Dependent
Raster images have **fixed resolution**. A 72 DPI image has only 72 pixels per inch. Zoom too much and you see individual pixels (pixelation). Both images look the same at normal size, but zoom reveals the difference!
:::

## Vector vs. Raster Comparison

| Aspect | Vector (PDF, SVG, EPS) | Raster (PNG, TIFF, JPG) |
|--------|------------------------|-------------------------|
| **Definition** | Mathematical formulas | Grid of pixels |
| **Scalability** | Infinite resolution | Fixed resolution (DPI) |
| **File Size** | Small (formulas compact) | Large (all pixels stored) |
| **Best For** | Plots, diagrams, text, screenshots of websites | Photos, screenshots |
| **Editability** | Easy to edit paths | Pixel-level editing only |
| **Text Quality** | Always crisp | Can become blurry |

## Demonstration: Vector vs. Raster

```{r}
#| echo: true
#| eval: true
#| fig-width: 8
#| fig-height: 3

library(ggplot2)

# Create a plot with text and lines
p <- ggplot(data.frame(x = 1:5, y = c(2, 4, 3, 5, 4)),
            aes(x, y)) +
  geom_line(linewidth = 2, color = "steelblue") +
  geom_point(size = 5, color = "darkred") +
  annotate("text", x = 3, y = 3.5,
           label = "TEXT QUALITY MATTERS",
           size = 8, fontface = "bold") +
  theme_classic(base_size = 16) +
  labs(title = "Vector vs Raster: Notice Text Clarity",
       x = "X Axis Label", y = "Y Axis Label")

# Save as vector (PDF)
ggsave("demo_vector.pdf", p, width = 8, height = 3, device = cairo_pdf)

# Save as high-res PNG (300 DPI)
ggsave("demo_highres.png", p, width = 8, height = 3, dpi = 300)

# Save as low-res PNG (72 DPI) - simulate poor quality
ggsave("demo_lowres.png", p, width = 8, height = 3, dpi = 72)

# Save as JPEG (lossy compression)
ggsave("demo_jpeg.jpg", p, width = 8, height = 3, dpi = 150, quality = 75)

p
```

**Try zooming to 400% in each file!**

- PDF: Text stays crisp at any zoom level
- Low-res PNG: Text becomes pixelated
- JPEG: Notice compression artifacts around text

## Container Formats: PDF and TIFF

::: {.callout-important}
## PDF and TIFF are Containers!

Both **PDF** and **TIFF** can contain EITHER vector OR raster data:

- **PDF**: Can contain vector graphics, raster images, or both
- **TIFF**: Usually raster, but can embed vector data
:::

**TIFF Compression Options:**

| Type | Description | Use Case |
|------|-------------|----------|
| **Uncompressed** | No compression (huge files) | Archival |
| **LZW** | Lossless compression | Publications |
| **ZIP** | Lossless compression | Publications |
| **JPEG** | Lossy compression | Web (avoid for science) |

## Resolution Requirements

| Use Case | Minimum DPI | Recommended |
|----------|-------------|-------------|
| Screen viewing | 72-96 | 150 |
| Print publication | 300 | 300-600 |
| High-quality journal | 600-1200 | 600 |
| Poster (arm's length) | 150 | 150-300 |

## Format Selection: Decision Tree

```{mermaid}
%%| fig-width: 10
flowchart TD
    A[What type of image?] --> B{Photo or<br/>screenshot?}
    B -->|Yes| C{Where will it<br/>be used?}
    B -->|No: Created<br/>figure/plot| D{Publication<br/>or presentation?}

    C -->|Publication| E[High-res TIFF<br/>or PNG<br/>300+ DPI]
    C -->|Presentation/Web| F[JPEG or PNG<br/>150 DPI]

    D -->|Publication| G{Vector support?}
    D -->|Presentation| H{Need<br/>transparency?}

    G -->|Yes| I[PDF preferred<br/>or SVG]
    G -->|No| J[EPS format<br/>widely accepted]
    G -->|Raster only| K[PNG 300 DPI<br/>or TIFF LZW]

    H -->|Yes| L[PNG<br/>transparent BG]
    H -->|No| M[PNG or PDF<br/>quick & dirty]

    style I fill:#2ecc71
    style J fill:#27ae60
    style K fill:#f39c12
    style E fill:#3498db
    style L fill:#9b59b6
    style M fill:#95a5a6
```

## Quick and Dirty: PNG

::: {.columns}
::: {.column width="50%"}
**For rapid work:**

```r
# PNG is lossless and fast
ggsave("quick_plot.png",
       dpi = 150)
```

✓ Lossless compression
✓ Fast to generate
✓ Works everywhere
✓ Good for drafts
:::

::: {.column width="50%"}
**For publications:**

```r
# Use vector formats
ggsave("publication.pdf",
       device = cairo_pdf)
```

✓ Infinite resolution
✓ Small file size
✓ Professional quality
✓ Easy to edit
:::
:::

## JPEG Compression Artifacts

```{r}
#| echo: true
#| eval: true
#| fig-width: 10
#| fig-height: 4

library(ggplot2)
library(patchwork)

# Create a plot with sharp edges and text
create_test_plot <- function(title) {
  ggplot(data.frame(x = c(0, 1, 1, 0, 0),
                    y = c(0, 0, 1, 1, 0)),
         aes(x, y)) +
    geom_polygon(fill = "white", color = "black", linewidth = 2) +
    annotate("text", x = 0.5, y = 0.5,
             label = "SHARP TEXT",
             size = 12, fontface = "bold") +
    theme_void() +
    theme(plot.background = element_rect(fill = "gray90", color = NA),
          plot.title = element_text(size = 10, hjust = 0.5)) +
    labs(title = title) +
    coord_fixed()
}

p1 <- create_test_plot("Original Vector")
p2 <- create_test_plot("After JPEG Compression\n(Notice artifacts)")

# Save and reload to show compression
ggsave("temp_jpeg.jpg", p2, width = 4, height = 4, dpi = 150, quality = 60)

p1 + p2 +
  plot_annotation(
    title = "JPEG Creates Artifacts Around Sharp Edges",
    theme = theme(plot.title = element_text(size = 16, face = "bold"))
  )
```

::: {.callout-warning}
## Real-World Problem

"Graphics downloaded from the Web are not acceptable for print reproduction as they are low-resolution images (usually 72 dpi)"

— European Journal of Orthodontics

JPG creates **blocking artifacts** around sharp edges and text!
:::

## File Format Comparison Code

```{r}
#| echo: true
#| eval: true

# Generate comparison files
library(ggplot2)

comparison_plot <- ggplot(mtcars, aes(wt, mpg)) +
  geom_point(size = 3, color = "steelblue") +
  geom_smooth(method = "lm", color = "darkred", linewidth = 1.5) +
  annotate("text", x = 4, y = 30,
           label = "Zoom this text to 400%!",
           size = 6, fontface = "bold") +
  theme_classic(base_size = 14) +
  labs(title = "Vector vs Raster Comparison",
       x = "Weight (1000 lbs)",
       y = "Miles Per Gallon")

# Vector format - always crisp
ggsave("compare_vector.pdf", comparison_plot,
       width = 6, height = 4, device = cairo_pdf)

# High-res PNG - good quality
ggsave("compare_highres.png", comparison_plot,
       width = 6, height = 4, dpi = 300)

# Low-res PNG - pixelated when zoomed
ggsave("compare_lowres.png", comparison_plot,
       width = 6, height = 4, dpi = 72)

# JPEG - compression artifacts
ggsave("compare_jpeg.jpg", comparison_plot,
       width = 6, height = 4, dpi = 150, quality = 60)

comparison_plot
```

**Files generated - compare them yourself:**

- `compare_vector.pdf` - Infinite zoom, always crisp
- `compare_highres.png` - Good for most uses (300 DPI)
- `compare_lowres.png` - Pixelated when zoomed (72 DPI)
- `compare_jpeg.jpg` - Artifacts around lines and text

## EPS Format: The Alternative Vector

::: {.callout-tip}
## When PDF is Not Supported

Some journals don't accept PDF but **DO accept EPS** (Encapsulated PostScript):

```r
# Save as EPS instead of PDF
ggsave("figure.eps",
       width = 6, height = 4,
       device = cairo_ps)
```

**EPS is widely accepted** in academic publishing when PDF is rejected.

- Nature journals: ✓ EPS accepted
- Science: ✓ EPS accepted
- Many medical journals: ✓ EPS preferred over PDF
:::

## Vector Screenshots from Websites

::: {.callout-tip}
## Capturing Website Content as Vector Graphics

**Google Chrome has a built-in feature to save web pages as PDF (vector format)!**

### Method 1: Print to PDF (Recommended)

1. Open the webpage in Google Chrome
2. Press `Ctrl+P` (Windows/Linux) or `Cmd+P` (Mac)
3. Select **"Save as PDF"** as the destination
4. Adjust settings:
   - Uncheck "Headers and footers" for cleaner output
   - Set margins as needed
   - Choose "Background graphics" if you want colors
5. Click "Save"

**Result:** Vector-based PDF that can be zoomed infinitely!

### Method 2: Chrome DevTools (For Specific Elements)

1. Open Chrome DevTools (`F12` or `Ctrl+Shift+I`)
2. Right-click on the element you want to capture
3. Select "Capture node screenshot" (saves as PNG)
4. For vector: Use Print to PDF method instead

### Why This Matters

- **Text stays crisp** - Perfect for including web-based figures
- **Smaller file size** - Vector PDF is compact
- **Editable** - Can extract or edit elements in PDF editor
- **Publication quality** - No pixelation when zoomed
:::

### Use Cases

```r
# After saving webpage as PDF, you can include in your document
# Or extract specific figures using PDF tools
```

**Examples:**

- Capture ColorBrewer website for reference
- Save interactive plot demonstrations
- Document online data visualization examples
- Include web-based tools in presentations

::: {.callout-note}
## Alternative: Browser Extensions

For more control:
- **Awesome Screenshot** - Can save as PDF
- **Full Page Screen Capture** - Saves entire page
- **FireShot** - Multiple format options including PDF

But Chrome's built-in Print to PDF is usually sufficient!
:::

## Recommendations

::: {.callout-tip}
## Best Practices

1. **Default choice**: PDF (vector) for all plots and diagrams
   - Use `device = cairo_pdf` for best quality

2. **If PDF not accepted**: EPS format (also vector)
   - Use `device = cairo_ps`

3. **If raster needed**: PNG at 300+ DPI
   - Lossless compression
   - Supports transparency

4. **Never**: JPG for plots with text or lines
   - Lossy compression creates artifacts
   - Only for photographs

5. **Quick drafts**: PNG at 150 DPI
   - Fast and lossless
   - Good for sharing in progress

6. **Journal submission**: Check guidelines
   - Usually: PDF, EPS, or high-res TIFF
   - Rarely: PNG (but accepted)
   - Never: JPG for line art
:::

## Summary: Format Cheat Sheet

| Format | Type | Compression | Best Use | Avoid For |
|--------|------|-------------|----------|-----------|
| **PDF** | Vector | Lossless | Publications, plots | Photos |
| **EPS** | Vector | None | Publications | Modern web |
| **SVG** | Vector | Text-based | Web graphics | Print journals |
| **PNG** | Raster | Lossless | Screenshots, drafts | Large images |
| **TIFF** | Raster | Lossless/Lossy | Journals, archival | Presentations |
| **JPEG** | Raster | Lossy | Photos only | Any plots/diagrams |
