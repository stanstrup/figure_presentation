# File Formats {background-color="#3498db"}

## The Format Question

**Which format should I use?**

::: {.incremental}

- **Type of image**

\

- Journal submission?
- Poster presentation?
- PowerPoint?
- Web/online?
:::



## What is a Raster Image?

:::: {.columns}
::: {.column width="50%"}
**Raster graphics are grids of colored pixels**

- Stores individual pixel colors: RGB(255, 128, 64)
- Fixed resolution measured in DPI (Dots Per Inch)
- More pixels = higher resolution = larger file size
- Cannot be scaled up without quality loss
:::

::: {.column width="50%"}
![](sources/Rgb-raster-image.svg){width=100%}
:::
::::

## What is a Vector Image?

```{r}
#| echo: false
#| eval: true

library(ggplot2)

# Create a smooth curved line
x <- seq(0, 4*pi, length.out = 200)
curve_data <- data.frame(
  x = x,
  y = sin(x) * exp(-x/10)
)

# Create the plot
p <- ggplot(curve_data, aes(x, y)) +
  geom_line(color = "steelblue", linewidth = 3) +
  geom_point(data = curve_data[seq(1, 200, 25), ],
             color = "darkred", size = 4) +
  theme_classic(base_size = 16) +
  theme(
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  ) +
  labs(x = "", y = "")

# Save as SVG (vector format)
ggsave("plots/01_formats/vector-curve.svg", p, width = 6, height = 4, device = "svg")
```

::::: {.columns}
:::: {.column width="50%"}
**Vector graphics use mathematical descriptions**

- Mathematical formulas define shapes and lines
- "Draw a line from point (0,0) to (10,10)"
- "Create a circle with center (5,5) and radius 3"
- Infinitely scalable without quality loss

::: {.callout-note}
## Infinite Resolution
Because vectors are mathematical formulas, they can be scaled to **any size** without losing quality. The curve is defined by equations, not pixels!
:::
::::

:::: {.column width="50%"}
![](plots/01_formats/vector-curve.svg){width=100%}
::::
:::::



## Vector vs. Raster Comparison


```{r}
#| echo: false
#| eval: true
#| fig-width: 12
#| fig-height: 6

library(ggplot2)
library(magick)
library(glue)

# Create a smooth curve with text
x <- seq(0, 4*pi, length.out = 200)
curve_data <- data.frame(x = x, y = sin(x) * exp(-x/10))

p <- ggplot(curve_data, aes(x, y)) +
  geom_line(color = "steelblue", linewidth = 3) +
  geom_point(data = curve_data[seq(1, 200, 20), ],
             color = "darkred", size = 4) +
  annotate("text", x = 6, y = 0.6,
           label = "Smooth Curve",
           size = 10, fontface = "bold", color = "navy") +
  theme_classic(base_size = 18) +
  theme(plot.title = element_text(face = "bold", size = 20)) +
  labs(title = "Mathematical Curve", x = "", y = "")

# Save as SVG (vector - web compatible)
ggsave("plots/01_formats/vector_demo.svg", p, width = 8, height = 4)

# Save as low-res PNG (raster)
ggsave("plots/01_formats/raster_demo.png", p, width = 8, height = 4, dpi = 72)

# Read the saved images and zoom in to show difference
oversize_scale <- 10
vector <- image_read_svg("plots/01_formats/vector_demo.svg", width = 576*oversize_scale)

vector_crop <- vector %>% 
  image_crop(glue("{100*oversize_scale}x{50*oversize_scale}+{300*oversize_scale}+{75*oversize_scale}")) %>% 
  image_scale("900x600")


oversize_scale <- 1
raster_crop <- image_read("plots/01_formats/raster_demo.png",   density = 72*oversize_scale) %>% 
  image_crop(glue("{100*oversize_scale}x{50*oversize_scale}+{300*oversize_scale}+{75*oversize_scale}")) %>% 
  image_scale("900x600")


# Add labels
vector_labeled <- image_annotate(vector_crop, "VECTOR (SVG)\nStays Crisp",
                                  size = 40, color = "green",
                                  location = "+10+10", font = "sans", weight = 700)
raster_labeled <- image_annotate(raster_crop, "RASTER (PNG 72 DPI)\nPixelated",
                                  size = 40, color = "red",
                                  location = "+10+10", font = "sans", weight = 700)

vector
```

## Vector vs. Raster Comparison (2)

```{r}
#| echo: false
#| eval: true
#| fig-width: 12
#| fig-height: 6

# Combine side by side
combined <- image_append(c(vector_labeled, raster_labeled))
combined
```

| Aspect | Vector (PDF, SVG, EPS) | Raster (PNG, TIFF, JPG) |
|--------|------------------------|-------------------------|
| **Definition** | Mathematical formulas | Grid of pixels |
| **Scalability** | Infinite resolution | Fixed resolution (DPI) |
| **File Size** | Small (formulas compact) | Large (all pixels stored) |
| **Best For** | Plots, diagrams, text, screenshots of websites | Photos, screenshots |
| **Editability** | Easy to edit paths | Pixel-level editing only |
| **Text Quality** | Always crisp | Can become blurry |



## Container Formats: PDF and TIFF

::: {.callout-important}
## PDF and TIFF are Containers!

Both **PDF** and **TIFF** can contain EITHER vector OR raster data:

- **PDF**: Can contain vector graphics, raster images, or both
- **TIFF**: Usually raster, but can embed vector data
:::

**TIFF Compression Options:**

| Type | Description | Use Case |
|------|-------------|----------|
| **Uncompressed** | No compression (huge files) | Archival |
| **LZW** | Lossless compression | Publications |
| **ZIP** | Lossless compression | Publications |
| **JPEG** | Lossy compression | Web (avoid for science) |


## Format Selection: Decision Tree

```{mermaid}
%%{init: {'theme':'dark', 'themeVariables': {'edgeLabelBackground':'#1a1a1a', 'primaryTextColor':'#fff', 'secondaryTextColor':'#fff', 'tertiaryTextColor':'#fff'}}}%%

flowchart LR
    A[What type of image?] --> B{Photo}
    A --> C{Screenshot}
    A --> D{Generated figure/<br/>website snapshot}

    B --> B1{Where will it<br/>be used?}
    B1 -->|Publication| B2[TIFF LZW<br/>300+ DPI]
    B1 -->|Presentation/Web| B3[JPEG/WebP <br/> 150+ DPI]

    C --> C1{Where will it<br/>be used?}
    C1 -->|Publication| C2[TIFF LZW<br/>300+ DPI]
    C1 -->|Presentation/Web| C3[PNG<br/>150 DPI]

    D --> D1{Publication or<br/>presentation?}
    D1 -->|Publication| D2{Vector support?}
    D1 -->|Presentation/Web| D3[SVG or PNG]

    D2 -->|Yes| D4[PDF / SVG / EPS<br/>All equivalent vectors]
    D2 -->|No| D5[TIFF 600+ DPI LZW<br/>PNG not supported]

    style A fill:#5dade2,color:#fff
    style B fill:#5dade2,color:#fff
    style C fill:#5dade2,color:#fff
    style D fill:#5dade2,color:#fff
    style B1 fill:#5dade2,color:#fff
    style C1 fill:#5dade2,color:#fff
    style D1 fill:#5dade2,color:#fff
    style D2 fill:#5dade2,color:#fff
    style D4 fill:#2ecc71,color:#fff
    style D5 fill:#5dade2,color:#fff
    style D3 fill:#9b59b6,color:#fff
    style B2 fill:#3498db,color:#fff
    style B3 fill:#e74c3c,color:#fff
    style C2 fill:#3498db,color:#fff
    style C3 fill:#9b59b6,color:#fff

```

## Format Properties Comparison

| Format | Type | Compression | Container? | Notes |
|--------|------|-------------|------------|-------|
| **PDF** | Vector + Raster | Lossless | Yes | Can embed both vector and raster data |
| **EPS** | Vector | Lossless | Yes | Can embed fonts and images |
| **SVG** | Vector | Lossless | No | XML-based, web-native |
| **PNG** | Raster | Lossless | No | Supports transparency |
| **TIFF** | Raster | Lossless or Lossy | Yes | Multiple pages, various compression options |
| **JPEG** | Raster | Lossy | No | Best for photos only |
| **WebP** | Raster | Lossless or Lossy | No | Modern web format, smaller than PNG/JPEG |

: {tbl-colwidths="[10,18,15,10,47]"}

::: {.callout-note}

## Container Formats

**Container formats** can hold multiple types of data or multiple images:
- **PDF**: Can mix vector graphics, raster images, fonts, and text
- **EPS**: Can embed fonts, preview images, and vector data
- **TIFF**: Can contain multiple pages/images with different compression

**Non-container formats** store a single image with one encoding type.

:::


## JPEG Compression Artifacts

```{r}
#| echo: false
#| eval: true
#| fig-width: 12
#| fig-height: 6

library(ggplot2)
library(magick)

# Create a plot with sharp edges and text
create_test_plot <- function() {
  ggplot(data.frame(x = c(0, 1, 1, 0, 0),
                    y = c(0, 0, 1, 1, 0)),
         aes(x, y)) +
    geom_polygon(fill = "white", color = "black", linewidth = 2) +
    annotate("text", x = 0.5, y = 0.5,
             label = "SHARP TEXT",
             size = 12, fontface = "bold") +
    theme_void() +
    theme(plot.background = element_rect(fill = "gray90", color = NA)) +
    coord_fixed()
}

p <- create_test_plot()

# Save as PNG (lossless) and JPEG (lossy with low quality)
ggsave("plots/01_formats/artifacts_original.png", p, width = 4, height = 4, dpi = 150)
ggsave("plots/01_formats/artifacts_jpeg.jpg", p, width = 4, height = 4, dpi = 150, quality = 60)

# Read and zoom in on the edge to show artifacts
png_img <- image_read("plots/01_formats/artifacts_original.png")
jpeg_img <- image_read("plots/01_formats/artifacts_jpeg.jpg")

# Crop and zoom 4x on the edge where artifacts are visible
crop_geom <- "100x100+450+250"
png_crop <- image_crop(png_img, crop_geom) %>% image_scale("600x600")
jpeg_crop <- image_crop(jpeg_img, crop_geom) %>% image_scale("600x600")

# Add labels
png_labeled <- image_annotate(png_crop, "PNG (Lossless)\nSharp Edges",
                               size = 30, color = "green",
                               location = "+10+10", font = "sans", weight = 700)
jpeg_labeled <- image_annotate(jpeg_crop, "JPEG (Quality 60)\nCompression Artifacts",
                                size = 30, color = "red",
                                location = "+10+10", font = "sans", weight = 700)

# Combine side by side
combined <- image_append(c(png_labeled, jpeg_labeled))
combined
```


## File Format Comparison

```{r}
#| echo: false
#| eval: true
#| fig-width: 12
#| fig-height: 12

# Generate comparison files
library(ggplot2)
library(magick)
library(glue)

comparison_plot <- ggplot(mtcars, aes(wt, mpg)) +
  geom_point(size = 3, color = "steelblue") +
  geom_smooth(method = "lm", color = "darkred", linewidth = 1.5) +
  annotate("text", x = 4, y = 30,
           label = "Zoom to see quality!",
           size = 6, fontface = "bold") +
  theme_classic(base_size = 14) +
  labs(title = "Vector vs Raster Comparison",
       x = "Weight (1000 lbs)",
       y = "Miles Per Gallon")

# Vector format - always crisp (SVG for web)
ggsave("plots/01_formats/compare_vector.svg", comparison_plot,
       width = 6, height = 4, device = "svg")

# High-res PNG - good quality
ggsave("plots/01_formats/compare_highres.png", comparison_plot,
       width = 6, height = 4, dpi = 300)

# Low-res PNG - pixelated when zoomed
ggsave("plots/01_formats/compare_lowres.png", comparison_plot,
       width = 6, height = 4, dpi = 72)

# JPEG - compression artifacts
ggsave("plots/01_formats/compare_jpeg.jpg", comparison_plot,
       width = 6, height = 4, dpi = 150, quality = 60)

# Read and zoom in on text area to show differences
# Base dimensions: 6 inches wide * 72 DPI = 432 pixels (low-res baseline)

# Vector: Read at very high resolution (10x the base size)
oversize_scale <- 10
vector_img <- image_read_svg("plots/01_formats/compare_vector.svg", width = 432*oversize_scale)

# Crop a region from the vector (scaled by oversize_scale) and zoom to display size
vector_crop <- vector_img %>%
  image_crop(glue("{200*oversize_scale}x{100*oversize_scale}+{800*oversize_scale}+{50*oversize_scale}")) %>%
  image_scale("600x300")

# PNG 300 DPI: Native size is 1800x1200 (6" * 300 DPI)
# Scale factor relative to 72 DPI base: 300/72 = 4.167
scale_300 <- 300/72
highres_crop <- image_read("plots/01_formats/compare_highres.png") %>%
  image_crop(glue("{200*scale_300}x{100*scale_300}+{800*scale_300}+{50*scale_300}")) %>%
  image_scale("600x300")

# PNG 72 DPI: Native size is 432x288 (6" * 72 DPI) - our baseline
scale_72 <- 1
lowres_crop <- image_read("plots/01_formats/compare_lowres.png") %>%
  image_crop(glue("{200*scale_72}x{100*scale_72}+{800*scale_72}+{50*scale_72}")) %>%
  image_scale("600x300")

# JPEG 150 DPI: Native size is 900x600 (6" * 150 DPI)
# Scale factor relative to 72 DPI base: 150/72 = 2.083
scale_150 <- 150/72
jpeg_crop <- image_read("plots/01_formats/compare_jpeg.jpg") %>%
  image_crop(glue("{200*scale_150}x{100*scale_150}+{800*scale_150}+{50*scale_150}")) %>%
  image_scale("600x300")

# Add labels
vector_labeled <- image_annotate(vector_crop, "SVG (Vector)",
                                  size = 25, color = "green",
                                  location = "+10+10", font = "sans", weight = 700)
highres_labeled <- image_annotate(highres_crop, "PNG 300 DPI",
                                   size = 25, color = "darkgreen",
                                   location = "+10+10", font = "sans", weight = 700)
lowres_labeled <- image_annotate(lowres_crop, "PNG 72 DPI",
                                  size = 25, color = "orange",
                                  location = "+10+10", font = "sans", weight = 700)
jpeg_labeled <- image_annotate(jpeg_crop, "JPEG Q60",
                                size = 25, color = "red",
                                location = "+10+10", font = "sans", weight = 700)

# Combine in 2x2 grid
top_row <- image_append(c(vector_labeled, highres_labeled))
bottom_row <- image_append(c(lowres_labeled, jpeg_labeled))
combined <- image_append(c(top_row, bottom_row), stack = TRUE)
combined
```

## Vector Screenshots from Websites

::: {.callout-tip}

## Capturing Website Content as Vector Graphics

**Google Chrome has a built-in feature to save web pages as PDF (vector format)!**

### Method 1: Print to PDF (Recommended)

1. Open the webpage in Google Chrome
2. Press `Ctrl+P` (Windows/Linux) or `Cmd+P` (Mac)
3. Select **"Save as PDF"** as the destination
4. Adjust settings:
   - Uncheck "Headers and footers" for cleaner output
   - Set margins as needed
   - Choose "Background graphics" if you want colors
5. Click "Save"

**Result:** Vector-based PDF that can be zoomed infinitely!

### Method 2: Chrome DevTools (For Specific Elements)

1. Open Chrome DevTools (`F12` or `Ctrl+Shift+I`)
2. Right-click on the element you want to capture
3. Select "Capture node screenshot" (saves as PNG)
4. For vector: Use Print to PDF method instead

### Why This Matters

- **Text stays crisp** - Perfect for including web-based figures
- **Smaller file size** - Vector PDF is compact
- **Editable** - Can extract or edit elements in PDF editor
- **Publication quality** - No pixelation when zoomed

:::

### Use Cases

```r
# After saving webpage as PDF, you can include in your document
# Or extract specific figures using PDF tools
```

**Examples:**

- Capture ColorBrewer website for reference
- Save interactive plot demonstrations
- Document online data visualization examples
- Include web-based tools in presentations

::: {.callout-note}

## Alternative: Browser Extensions

For more control:
- **Awesome Screenshot** - Can save as PDF
- **Full Page Screen Capture** - Saves entire page
- **FireShot** - Multiple format options including PDF

But Chrome's built-in Print to PDF is usually sufficient!

:::

## Recommendations

::: {.callout-tip}

## Best Practices

1. **Default choice**: PDF (vector) for all plots and diagrams
   - Use `device = cairo_pdf` for best quality

2. **If PDF not accepted**: EPS format (also vector)
   - Use `device = cairo_ps`

3. **If raster needed**: PNG at 300+ DPI
   - Lossless compression
   - Supports transparency

4. **Never**: JPG for plots with text or lines
   - Lossy compression creates artifacts
   - Only for photographs

5. **Quick drafts**: PNG at 150 DPI
   - Fast and lossless
   - Good for sharing in progress

6. **Journal submission**: Check guidelines
   - Usually: PDF, EPS, or high-res TIFF
   - Rarely: PNG (but accepted)
   - Never: JPG for line art

:::

## Summary: Format Cheat Sheet

| Format | Type | Compression | Best Use | Avoid For |
|--------|------|-------------|----------|-----------|
| **PDF** | Vector | Lossless | Publications, plots | Photos |
| **EPS** | Vector | None | Publications | Modern web |
| **SVG** | Vector | Text-based | Web graphics | Print journals |
| **PNG** | Raster | Lossless | Screenshots, drafts | Large images |
| **TIFF** | Raster | Lossless/Lossy | Journals, archival | Presentations |
| **JPEG** | Raster | Lossy | Photos only | Any plots/diagrams |


