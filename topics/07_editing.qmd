# Post-Export Editing {background-color="#16a085"}

## Why Edit After Export?

**Legitimate uses:**

::: {.incremental}
- Combine multiple plots into multi-panel figures (A, B, C labels)
- Fine-tune alignment and spacing
- Add annotations, arrows, or highlights
- Adjust layout without re-running analysis
:::

## Vector Editing Tools

::: {.columns}
::: {.column width="50%"}
**Inkscape**

- Free & open source
- Native SVG format
- Excellent PDF import
- Cross-platform
- Full-featured vector editor
:::

::: {.column width="50%"}
**Other options:**

- **Adobe Illustrator**: Industry standard (commercial)
- **PowerPoint**: Can edit SVG as vector format
:::
:::

::: {.callout-warning}
## ⚠️ Avoid Raster Editors!

**DO NOT use Photoshop, GIMP, or other raster editors** for plots!

- These convert your plots to pixels (rasterization)
- You lose scalability and editability
- Text becomes uneditable
- Quality degrades when resized

**Keep it vector!** Use Inkscape, Illustrator, or PowerPoint with SVG.
:::



## Aligning Multiple Plots

**In Inkscape:**

1. Import all plots
2. Select all panels
3. Use alignment tools (Ctrl+Shift+A):
   - Align left edges
   - Distribute vertically with equal spacing
4. Ensure axis widths match for stacked plots

## Inkscape Basics

**Opening PDFs/SVGs:**

1. File → Open → Select PDF or SVG
2. For PDFs: Choose "Import via Poppler" for best results
3. Each plot element is now editable

**Useful tools:**

- Selection tool (F1): Move and resize
- Text tool (F8): Edit or add text
- Align and Distribute (Ctrl+Shift+A)
- Guides (drag from rulers): Align elements precisely

**Tips:**

- Group related elements (Ctrl+G)
- Lock layers to prevent accidental edits
- Use layers for complex figures

## Combining Plots: R vs. Post-Processing

::: {.columns}
::: {.column width="50%"}
**In R (patchwork)**

```{r}
#| label: editing-patchwork
#| echo: true
#| eval: false

library(patchwork)
p1 + p2 +
  plot_annotation(
    tag_levels = 'A'
  )
```

Fully reproducible!
:::

::: {.column width="50%"}
**In Inkscape**

- More layout control
- Easier fine-tuning
- Less reproducible
- Good for final polish
:::
:::

## When to Use Each Approach

**Use R (patchwork):**

- Simple multi-panel layouts
- Need to regenerate frequently
- Sharing code with collaborators

**Use Inkscape:**

- Complex layouts with mixed content
- Final publication figure
- Need pixel-perfect alignment
- Adding non-data elements (photos, diagrams)

## Avoiding Common Pitfalls

::: {.callout-warning}
## Watch Out!

1. **Don't convert to raster**: Keep as vector
2. **Don't edit data**: Only layout/labels
3. **Save source files**: Keep .ai or .svg
4. **Export final as PDF**: For submission
5. **Document changes**: Note what was done manually
:::

## Example: Multi-Panel Figure

```{r}
#| label: editing-multi-panel
#| echo: true
#| eval: false

# Create 4 plots in R
p1 <- ggplot(mtcars, aes(wt, mpg)) + geom_point() +
      theme_classic(base_size = 10)
p2 <- ggplot(iris, aes(Sepal.Length, Sepal.Width)) + geom_line() +
      theme_classic(base_size = 10)
p3 <- ggplot(faithful, aes(eruptions)) + geom_histogram() +
      theme_classic(base_size = 10)
p4 <- ggplot(mtcars, aes(factor(cyl), mpg)) + geom_boxplot() +
      theme_classic(base_size = 10)

# Export each
walk2(list(p1, p2, p3, p4),
      paste0("panel_", letters[1:4], ".pdf"),
      ~ggsave(.y, .x, width = 3, height = 3))

# Then combine in Inkscape
# 2×2 layout with labels A-D
```


# Combine figures directly in R instead {background-color="#16a085"}

## The patchwork Package

**A better alternative to manual composition!**

```{r}
#| label: setup-patchwork
#| echo: false
#| eval: true
#| message: false

library(ggplot2)
library(patchwork)

# Create sample plots
p1 <- ggplot(mtcars, aes(wt, mpg)) +
  geom_point(color = "steelblue") +
  labs(title = "Scatter") +
  theme_classic(base_size = 10)

p2 <- ggplot(mtcars, aes(factor(cyl), mpg)) +
  geom_boxplot(fill = "lightblue") +
  labs(title = "Boxplot") +
  theme_classic(base_size = 10)

p3 <- ggplot(mtcars, aes(mpg)) +
  geom_histogram(bins = 15, fill = "coral") +
  labs(title = "Histogram") +
  theme_classic(base_size = 10)

p4 <- ggplot(mtcars, aes(hp, mpg)) +
  geom_point() + geom_smooth(method = "lm", se = FALSE) +
  labs(title = "With trend") +
  theme_classic(base_size = 10)
```

::: {.callout-tip}
## Why patchwork?

- **Fully reproducible** - no manual editing needed
- **Intuitive syntax** - `|` for side-by-side, `/` for stacked
- **Automatic labeling** - A, B, C, etc.
- **Flexible layouts** - complex arrangements possible
:::


## patchwork: Side by Side

```{r}
#| label: patchwork-horizontal
#| echo: true
#| eval: true
#| fig-width: 10
#| fig-height: 4

library(patchwork)

p1 | p2 | p3
```

## patchwork: Stacked Layout

```{r}
#| label: patchwork-vertical
#| echo: true
#| eval: true
#| fig-width: 6
#| fig-height: 8

p1 / p2 / p3
```

## patchwork: Grid Layout

```{r}
#| label: patchwork-grid
#| echo: true
#| eval: true
#| fig-width: 10
#| fig-height: 8

(p1 | p2) / (p3 | p4)
```

## Adding Panel Labels (A, B, C...)

```{r}
#| label: patchwork-labels
#| echo: true
#| eval: true
#| fig-width: 10
#| fig-height: 8

(p1 | p2) / (p3 | p4) +
  plot_annotation(tag_levels = 'A')
```

## Customizing Panel Labels

```{r}
#| label: patchwork-labels-custom
#| echo: true
#| eval: true
#| fig-width: 10
#| fig-height: 8

(p1 | p2) / (p3 | p4) +
  plot_annotation(
    tag_levels = 'A',
    tag_prefix = '(',
    tag_suffix = ')'
  ) &
  theme(plot.tag = element_text(face = 'bold', size = 14))
```



## Unequal Panel Sizes

```{r}
#| label: patchwork-widths
#| echo: true
#| eval: true
#| fig-width: 12
#| fig-height: 5

# First plot takes 2x width
p1 + p2 + p3 +
  plot_layout(widths = c(2, 1, 1)) +
  plot_annotation(tag_levels = 'A')
```

## Nested Layouts

```{r}
#| label: patchwork-nested
#| echo: true
#| eval: true
#| fig-width: 10
#| fig-height: 6

# Large plot on left, two stacked on right
p1 | (p2 / p3) +
  plot_annotation(tag_levels = 'A')
```



## Shared Legends with plot_layout()

```{r}
#| label: patchwork-legend
#| echo: true
#| eval: true
#| fig-width: 10
#| fig-height: 5

# Create plots with same color mapping
pa <- ggplot(mtcars, aes(wt, mpg, color = factor(cyl))) +
  geom_point() + theme_classic(base_size = 10)
pb <- ggplot(mtcars, aes(hp, mpg, color = factor(cyl))) +
  geom_point() + theme_classic(base_size = 10)

pa + pb +
  plot_layout(guides = 'collect') +
  plot_annotation(tag_levels = 'A')
```

## Saving patchwork Figures

```{r}
#| label: patchwork-save
#| echo: true
#| eval: false

# Create combined figure
combined <- (p1 | p2) / (p3 | p4) +
  plot_annotation(tag_levels = 'A')

# Save as vector (recommended)
ggsave("figure1.svg", combined, width = 10, height = 8)
ggsave("figure1.pdf", combined, width = 10, height = 8)

# Save as high-res raster if needed
ggsave("figure1.png", combined, width = 10, height = 8, dpi = 300)
```

## patchwork vs Manual Editing: Decision Guide

::: {.columns}
::: {.column width="50%"}
**patchwork (in R)**

✅ Fully reproducible

✅ Easy to update

✅ Automatic alignment

✅ Consistent styling

✅ Version controlled

⚠️ Less layout flexibility

\

**Use patchwork when:**

- All panels are ggplot2 objects
- Need reproducible figures
- Figures may need updates
- Sharing code with collaborators
:::

::: {.column width="50%"}
**Inkscape (manual editing)**

✅ Pixel-perfect control

✅ Mix with non-R content

✅ Complex annotations

❌ Not reproducible

❌ Manual re-editing

❌ Easy to break

\

**Use Inkscape when:**

- Need pixel-perfect alignment
- Adding photos, diagrams, or non-R content
- Very complex custom layouts
- Final publication polish only
:::
:::

