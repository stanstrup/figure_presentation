# ggplot2 Themes {background-color="#9b59b6"}

```{r}
#| label: setup-themes
#| echo: false
#| eval: true
#| message: false
#| warning: false

library(ggplot2)
library(patchwork)
library(ggpubr)
library(ggthemes)
library(hrbrthemes)
```

## The Default Problem


:::: {.columns}
::: {.column width="50%"}


```{r}
#| label: theme-default
#| echo: true
#| eval: true

# Default ggplot2 theme
p <- ggplot(mtcars, aes(wt, mpg, color = factor(cyl))) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Default theme_gray()",
       x = "Weight (1000 lbs)",
       y = "Miles Per Gallon",
       color = "Cylinders") +
  theme(plot.title = element_text(face = "bold"))
```

:::

::: {.column width="50%"}
```{r}
#| label: theme-default-show
#| echo: false
#| eval: true
#| fig-width: 8
#| fig-height: 5

p

```

:::
::::


**Problems:**

- Gray background (wastes ink, unprofessional)
- Too much "chart junk"
- Not publication-ready

## Built-in Theme: theme_bw()

:::: {.columns}
::: {.column width="50%"}


```{r}
#| label: theme-bw
#| echo: true
#| eval: true

p <- ggplot(mtcars, aes(wt, mpg, color = factor(cyl))) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "theme_bw() - White background, black border",
       x = "Weight (1000 lbs)",
       y = "Miles Per Gallon",
       color = "Cylinders") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"))
```
:::

::: {.column width="50%"}
```{r}
#| label: theme-bw-show
#| echo: false
#| eval: true
#| fig-width: 8
#| fig-height: 5

p
```
:::
::::

**Good for publications** - Clean with reference gridlines

## Built-in Theme: theme_classic()

:::: {.columns}
::: {.column width="50%"}

```{r}
#| label: theme-classic
#| echo: true
#| eval: true

p <- ggplot(mtcars, aes(wt, mpg, color = factor(cyl))) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "theme_classic() - No gridlines, clean axes",
       x = "Weight (1000 lbs)",
       y = "Miles Per Gallon",
       color = "Cylinders") +
  theme_classic() +
  theme(plot.title = element_text(face = "bold"))
```

:::

::: {.column width="50%"}

```{r}
#| label: theme-classic-show
#| echo: false
#| eval: true
#| fig-width: 8
#| fig-height: 5

p
```

:::
::::

**Very minimal** - Traditional journal style

## Built-in Theme: theme_minimal()

:::: {.columns}
::: {.column width="50%"}

```{r}
#| label: theme-minimal
#| echo: true
#| eval: true

p <- ggplot(mtcars, aes(wt, mpg, color = factor(cyl))) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "theme_minimal() - Subtle gridlines, modern",
       x = "Weight (1000 lbs)",
       y = "Miles Per Gallon",
       color = "Cylinders") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold"))
```

:::

::: {.column width="50%"}

```{r}
#| label: theme-minimal-show
#| echo: false
#| eval: true
#| fig-width: 8
#| fig-height: 5

p
```

:::
::::

**Good balance** - Clean with subtle reference lines

## Built-in Theme: theme_void()

:::: {.columns}
::: {.column width="50%"}

```{r}
#| label: theme-void
#| echo: true
#| eval: true

p <- ggplot(mtcars, aes(wt, mpg, color = factor(cyl))) +
  geom_point(size = 3) +
  labs(title = "theme_void() - Blank canvas") +
  theme_void() +
  theme(plot.title = element_text(face = "bold", hjust = 0.5),
        legend.position = "right")
```

:::

::: {.column width="50%"}

```{r}
#| label: theme-void-show
#| echo: false
#| eval: true
#| fig-width: 8
#| fig-height: 5

p
```

:::
::::

**For custom designs** - Maps, minimalist graphics

## Side-by-Side Comparison

```{r}
#| label: theme-comparison
#| echo: false
#| eval: true
#| fig-width: 14
#| fig-height: 10

# Create base plot
base_plot <- ggplot(mtcars, aes(wt, mpg)) +
  geom_point(aes(color = factor(cyl)), size = 2) +
  geom_smooth(method = "lm", se = FALSE, color = "black", linewidth = 0.5) +
  labs(x = "Weight", y = "MPG", color = "Cyl")

# Apply different themes
p1 <- base_plot + theme_gray() + labs(title = "theme_gray()\n(default)")
p2 <- base_plot + theme_bw() + labs(title = "theme_bw()")
p3 <- base_plot + theme_classic() + labs(title = "theme_classic()")
p4 <- base_plot + theme_minimal() + labs(title = "theme_minimal()")
p5 <- base_plot + theme_linedraw() + labs(title = "theme_linedraw()")
p6 <- base_plot + theme_light() + labs(title = "theme_light()")

(p1 | p2 | p3) / (p4 | p5 | p6) +
  plot_annotation(
    title = "Built-in ggplot2 Themes Comparison",
    theme = theme(plot.title = element_text(size = 18, face = "bold"))
  )
```

## Publication Package: ggpubr

::: {.columns}
::: {.column width="60%"}
```{r}
#| label: theme-ggpubr
#| echo: true
#| eval: true
#| fig-width: 8
#| fig-height: 5

# ggpubr - publication-ready themes and statistical annotations
# install.packages("ggpubr")

ggplot(mtcars, aes(x = factor(cyl), y = mpg)) +
  geom_boxplot(aes(fill = factor(cyl)), alpha = 0.7) +
  geom_jitter(width = 0.2, alpha = 0.5) +
  labs(title = "ggpubr - Publication ready with stats",
       x = "Cylinders",
       y = "Miles Per Gallon") +
  theme_pubr() +
  theme(legend.position = "none",
        plot.title = element_text(face = "bold")) +
  scale_fill_brewer(palette = "Set2")
```
:::

::: {.column width="40%"}
::: {.callout-tip}
## ggpubr Package

**Publication-ready themes + statistical annotations**

- `theme_pubr()` - Clean publication theme
- `theme_pubclean()` - Even more minimal
- `stat_regline_equation()` - Automatic regression equations
- `stat_cor()` - Correlation statistics
- `stat_compare_means()` - p-values and significance brackets
:::
:::
:::

## ggpubr: Adding Regression Equations

::: {.columns}
::: {.column width="50%"}
```{r}
#| label: ggpubr-regression-code
#| echo: true
#| eval: true

library(ggpubr)

p <- ggplot(mtcars, aes(x = wt, y = mpg)) +
  geom_point(size = 3, color = "steelblue") +
  geom_smooth(method = "lm", se = TRUE,
              color = "darkred", formula = y ~ x) +

      stat_regline_equation(
      aes(label = after_stat(eq.label)),
      formula = y ~ x,
      label.x.npc = 0.95,  # 95% to the right (relative)
      label.y.npc = 0.95,  # 95% to the top (relative)
      hjust = 1            # right-align text
    ) +
    stat_cor(
      aes(label = paste(after_stat(rr.label), after_stat(p.label), sep = "~~~~")),
      label.x.npc = 0.95, label.y.npc = 0.88, hjust = 1
    ) +
  
  labs(title = "Linear Regression with Equation",
       x = "Weight (1000 lbs)",
       y = "Miles Per Gallon") +
  theme_pubr()
```
:::

::: {.column width="50%"}
```{r}
#| label: ggpubr-regression
#| echo: false
#| eval: true
#| fig-width: 6
#| fig-height: 4

p
```

**Key function:** `stat_regline_equation()`

- Automatically calculates and displays equation
- Shows RÂ² value
- Customizable position and formatting
- Works with facets

:::
:::

## ggpubr: Pairwise Comparisons

::: {.columns}
::: {.column width="60%"}
```{r}
#| label: ggpubr-comparisons-code
#| echo: true
#| eval: true

# Automatically generate all pairwise comparisons
dose_levels <- levels(factor(ToothGrowth$dose))
my_comparisons <- combn(dose_levels, 2, simplify = FALSE)

p <- ggboxplot(ToothGrowth,
               x = "dose", y = "len", color = "dose", palette = "jco") +
  stat_compare_means(
                      comparisons = my_comparisons,
                      method = "t.test",
                      p.adjust.method = "BH"  # Holm correction
                    ) +
  stat_compare_means(
                      method = "anova",
                      label.y = 50
                    ) +
  labs(title = "Pairwise Comparisons with Multiple Testing Correction",
       x = "Dose (mg/day)",
       y = "Tooth Length")
```


:::

::: {.column width="40%"}
```{r}
#| label: ggpubr-comparisons-show
#| echo: false
#| eval: true
#| fig-width: 6
#| fig-height: 5

p
```




:::
:::


- `combn(levels, 2)` generates all pairs automatically
- `method = "t.test"` for pairwise tests (or `method = "tukey_hsd"` for Tukey's HSD)
- `p.adjust.method = "BH"` for multiple testing correction ("holm", "bonferroni", "hochberg", "BY", "fdr")
- `method = "anova"` for overall test
- Automatic significance brackets
 


## Modern Typography: hrbrthemes

::: {.columns}
::: {.column width="60%"}
```{r}
#| label: theme-hrbrthemes
#| echo: true
#| eval: true
#| fig-width: 10
#| fig-height: 7

ggplot(mtcars, aes(wt, mpg, color = factor(cyl))) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE, formula = y ~ x) +
  facet_wrap(~gear, labeller = label_both) +
  labs(title = "hrbrthemes::theme_ipsum() - Modern typography",
       subtitle = "Clean, professional, with excellent fonts and facets",
       x = "Weight (1000 lbs)",
       y = "Miles Per Gallon",
       color = "Cylinders") +
  theme_ipsum() +
  scale_color_ipsum()
```
:::

::: {.column width="40%"}
::: {.callout-note}
## hrbrthemes Package

**Modern professional typography**

- Uses high-quality fonts (requires font installation)
- `theme_ipsum()` - Modern, clean, professional
- `theme_ipsum_rc()` - Roboto Condensed font
- Excellent for presentations and reports
- Works beautifully with facets
- May require: `extrafont::font_import()`
:::
:::
:::

## Specialized Themes: ggthemes

```{r}
#| label: theme-ggthemes
#| echo: false
#| eval: true
#| fig-width: 14
#| fig-height: 10

# ggthemes - many professional themes
# install.packages("ggthemes")

base_plot <- ggplot(mtcars, aes(wt, mpg)) +
  geom_point(aes(color = factor(cyl)), size = 2) +
  labs(x = "Weight", y = "MPG", color = "Cyl")

p1 <- base_plot + theme_few() +
  labs(title = "theme_few()\n(Stephen Few design)")

p2 <- base_plot + theme_tufte() +
  labs(title = "theme_tufte()\n(Edward Tufte minimalist)")

p3 <- base_plot + theme_economist() + scale_color_economist() +
  labs(title = "theme_economist()\n(The Economist style)")

p4 <- base_plot + theme_fivethirtyeight() + scale_color_fivethirtyeight() +
  labs(title = "theme_fivethirtyeight()\n(538 website)")

p5 <- base_plot + theme_excel_new() + scale_color_excel_new() +
  labs(title = "theme_excel_new()\n(Modern Excel style)")

p6 <- base_plot + theme_gdocs() + scale_color_gdocs() +
  labs(title = "theme_gdocs()\n(Google Docs style)")

(p1 | p2 | p3) / (p4 | p5 | p6) +
  plot_annotation(
    title = "ggthemes Package: Professional Themes",
    theme = theme(plot.title = element_text(size = 18, face = "bold"))
  )
```

## Setting Global Theme

:::: {.columns}
::: {.column width="40%"}

**Set once, apply to all plots:**

```{r}
#| label: global-theme
#| echo: true
#| eval: true

# At top of script
theme_set(theme_bw(base_size = 12))

# Now all plots use theme_bw
# automatically
p1 <- ggplot(mtcars, aes(wt, mpg)) +
  geom_point() +
  labs(title = "Plot 1")

p2 <- ggplot(iris, aes(Sepal.Length, Sepal.Width)) +
  geom_point(aes(color = Species)) +
  labs(title = "Plot 2")

p3 <- ggplot(faithful, aes(eruptions)) +
  geom_histogram(bins = 30, fill = "steelblue") +
  labs(title = "Plot 3")
```

:::

::: {.column width="60%"}

```{r}
#| label: global-theme-show
#| echo: false
#| eval: true
#| fig-width: 10
#| fig-height: 6

p1 + p2 + p3 +
  plot_annotation(
    title = "All plots use the same theme automatically!",
    theme = theme(plot.title = element_text(size = 14, face = "bold"))
  )
```

:::
::::


## Font Considerations

```{r}
#| label: font-considerations
#| echo: true
#| eval: false

# Check available fonts
# library(extrafont)
font_import()  # First time only (takes a while)
fonts()        # List available fonts

# Use in theme
theme_classic(base_family = "Arial") +
  theme(
    plot.title = element_text(family = "Arial", face = "bold"),
    axis.title = element_text(family = "Arial")
  )
```

::: {.callout-note}
## Font Preferences by Journal

Many journals prefer specific fonts:

- **Arial** - Most common, widely accepted
- **Helvetica** - Classic choice
- **Times New Roman** - Traditional journals
- **Calibri** - Modern alternative

Check journal author guidelines!
:::

## Theme Elements You Can Customize

::: {.columns}
::: {.column width="50%"}
```{r}
#| label: theme-elements-code
#| echo: true
#| eval: true

p <- ggplot(mtcars, aes(x = factor(cyl), y = mpg, fill = factor(cyl))) +
  geom_boxplot(alpha = 0.7) +
  facet_wrap(~gear, labeller = label_both) +
  labs(title = "Customized Theme Elements",
       x = "Cylinders",
       y = "Miles Per Gallon",
       fill = "Cylinders") +
  theme_minimal() +
  theme(
    # Axis elements
    axis.title = element_text(size = 12, face = "bold", color = "navy"),
    axis.text = element_text(size = 10, color = "gray30"),
    # Legend
    legend.position = "bottom",
    legend.title = element_text(face = "bold"),
    legend.background = element_rect(fill = "gray95", color = "gray50"),
    # Panel
    panel.grid.major = element_line(color = "gray80", linewidth = 0.3),
    panel.grid.minor = element_blank(),
    panel.background = element_rect(fill = "white"),
    # Facet strips
    strip.background = element_rect(fill = "steelblue", color = "navy"),
    strip.text = element_text(color = "white", face = "bold", size = 11),
    # Plot
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.background = element_rect(fill = "white", color = NA)
  ) +
  scale_fill_brewer(palette = "Set2")
```
:::

::: {.column width="50%"}
```{r}
#| label: theme-elements
#| echo: false
#| eval: true
#| fig-width: 7
#| fig-height: 5

p
```

**Customizable elements:**

- `axis.title`, `axis.text` - Axis labels
- `legend.position` - "top", "bottom", "left", "right", "none"
- `panel.grid` - Gridlines
- `plot.background`, `panel.background` - Backgrounds
- `strip.background`, `strip.text` - Facet labels
:::
:::


## Recommendations

::: {.callout-tip}
## Best Practices

1. **Never use default** `theme_gray()` for publications
   - Gray background wastes ink and looks unprofessional

2. **Set global theme** at start of script for consistency
   - `theme_set(theme_classic())` applies to all subsequent plots

3. **Match journal style** - check published figures
   - Look at recent issues of your target journal
   - Note font choices, gridline presence, color schemes

4. **Keep it simple** - less chart junk = better
   - Remove unnecessary gridlines
   - Minimize non-data ink

5. **Use publication packages** for multi-panel figures
   - `patchwork` for intuitive combining syntax
   - `ggpubr::ggarrange()` for automatic labeling

:::

